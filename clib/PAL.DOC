



          PAL.BIN Version 0.95     Copyright 1991 by Ana.

         PAL.BIN はＢＡＳＩＣ用のバレット設定ルーチンです。





　　　　　　　※このファイルはタブ幅を８にしてご覧ください。

ｱ｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣ｵ
･                                 特徴                                   ･
ｹ｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣ｽ

◎ＶＳＹＮＣ割り込みによるオートフェードイン・フェードアウト機能を装備。
◎小さいプログラムと高速動作の両立。
◎整理され、洗練された関数群。

ｱ｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣ｵ
･ 　　　　　　  　　　　　　　　　内容     　                              ･
ｹ｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣ｽ

PAL.BIN の中には８つのルーチンが入っています。

address	name			function
   3	PAL.INIT	初期化
   6	PAL.SET		各バレットの最大輝度色の設定
   9	PAL.SHOW	輝度を指定して実際にパレットを設定する
  12	PAL.FADE	オートフェードイン・フェードアウト
  15	PAL.STAT	ステータスチェック
  18	PAL.DONE	後始末

※ address = 0 は何もしない（IRET だけが書いてある）ルーチンです。
　これは CALL 命令の変数名のタイプミスによる暴走を防ぐためです。

例：PAL.SHOW = 12:CALL PAL.SHAW( ･･･ )	' SHOW を SHAW とタイプミス
　　　変数 SHAW が初めて登場することになるので０番地をコールしてしまう。



ｱ｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣ｵ
･　  　　　　　　　　　　　　　　使い方                                    ･
ｹ｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣ｽ

PAL.INIT	: CALL PAL.INIT
	初期化。以下の各ルーチンを使用する前に一度呼ぶこと。

 =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

PAL.SET		: CALL PAL.SET( PAL.CODE, PAL.VALUE )

	PAL.CODE	: 0 ～ 15 のパレットコード。
	PAL.VALUE	: &H000 ～ &HFFF の色コード

	各パレットの最大輝度色の設定。このルーチンを CALL しただけでは実際にパレ	ットは変更されない。

 =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

PAL.SHOW	: CALL PAL.SHOW( PAL.GRADE )

	PAL.GRADE	: 0 ～ 16 の輝度

	実際にパレットを設定する。PAL.GRADE は輝度で、 0 ～ 16 の値を指定する。
	これを使って適当にループを組めば、セルフフェードイン・フェードアウトを
	簡単に実現できる。

 =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

PAL.FADE	: CALL PAL.FADE( PAL.RATE )

	PAL.RATE	: -127 ～ +127 （0 は除く）：フェードイン・アウト速度。

	ＶＳＹＮＣ割り込みを使って自動的にフェードイン・フェードアウトを行う。
	PAL.RATE が正ならフェードイン、負ならフェードアウトで、絶対値は輝度を
	一段階変化させるのに必要なＶＳＹＮＣ割り込みの数である。すなわち、
	-1 を指定すれば速くフェードアウトし、+4 を指定すればゆっくりフェードイ
	ンすることになる。フェードイン・フェードアウトは最後に PAL.SHOW で設定
	された輝度から開始され、最大輝度あるいは最小輝度に達すると自動的に動作
	を終了する。従って PAL.FADE を呼ぶ前には PAL.SHOW によって輝度を設定し
	ておく必要がある。

 =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

PAL.STAT	: CALL PAL.STAT( RET.VALUE )

	RET.VALUE	: オートフェードイン・フェードアウトの動作状況

	オートフェードイン・フェードアウトの動作状況を調べる。RET.VALUE に 1
	が返ってきたら動作中であることを意味する。RET.VALUE が 0 なら動作して
	おらず、-1 なら PAL.INIT が呼ばれていないことを示す。

 =-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=

PAL.DONE	: CALL PAL.DONE

	後始末ルーチン。ＶＳＹＮＣ割り込みを解放する。PAL.DONE を呼んだ後、
	再び上記の PAL.xxxx ルーチンを使用する場合は PAL.INIT を呼ぶ必要が
	ある。




ｱ｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣ｵ
･                           諸注意 ＆ ノウハウ                             ･
ｹ｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣ｽ

　PAL.BIN をロードして使う際は次のことに注意してください。

◆ロードする際、オフセットアドレスは必ず０にしてください。

◆通常は次の順序で PAL.BIN を使用します。

	BLOAD "PAL.BIN",0		' オフセットアドレスは必ず０に
	PAL.INIT%=3:PAL.SET%=6:PAL.SHOW%=9	' 各ルーチンのアドレス設定
	PAL.FADE%=12:PAL.STAT%=15:PAL.DONE%=18	' タイプミスに注意！
	　　…
	CALL PAL.INIT初期化
	FOR I = 0 TO 15
		CALL PAL.SET( ... )	' 最大輝度色の設定
	NEXT
	CALL PAL.SHOW( ... )		' 輝度の設定
	CALL PAL.FADE( ... )		' フェードイン開始
	　　…
	CALL PAL.DONE			' 後始末


◆プログラムサイズを減らすため、各ルーチンは渡されたパラメーターのチェックを一切行っていません。正しい範囲の値を渡すようにしてください。

◆PAL.BIN の後ろの方はワークエリアになっていて 00H が続いています。ここ以外はワークエリアは必要ありません。すなわち、プログラムの動作に必要なメモリの大きさは PAL.BIN のファイルサイズと同じだというこです。

◆雑誌掲載の時はワークエリアの 00H は全て要りません。0CFH が IRET のコードですから最後の 0CFH の後の 00H は全て取り払ってください。ただし、動作時はここをワークエリアとして使います。ここにデータなどを置いてしまうことのないように注意してください。

◆ワークエリアを 00H などに初期化する必要はありません。


◆前回の MAP.BIN の時にも書きましたが、くれぐれも暴走には注意してください。セグメントの設定やルーチンの名前、パラメーター変数の型などには細心の注意を払ってください。特にテストプログラムを作る上で犯しがちな間違いを挙げます。

・DEF SEG = … を DEFSEG = … と書いてしまう。
　これはDEFSEGという変数に値が代入されるだけでセグメントの設定は行われません。しかもたいへん見つけにくく、いちばんやっかいなバグです。エラーもでません。

・ルーチン名のタイプミス。
　CALL 文ではルーチンのアドレスを変数で指定しなくてはならないのですが、ここで変数名のタイプミスが生じる危険があるわけです。次のように毎回 CALL する直前にアドレスを設定する方法もありますが、
	A = 3:CALL A( … )
この場合、プログラムは読みにくくなりますし、アドレスの変更があった場合に直すのが大変です。また、3 や 9 などの簡単なアドレスのときはいいのですが、&H2F5 などという複雑なものになってくると今度はアドレスのタイプミスを起こす危険があります。
　PAL.BIN ではタイプミスをしても安全なように 0 番から始まるルーチンとして IRET だけのダミールーチンを配置しています。

・変数の型を間違う。
　たいがいのマシン語ルーチンは引き数として整数型の変数しか使用しません。しかし、ＢＡＳＩＣのディフォルトの変数型は単精度実数なのです。このギャップが問題を引き起こします。DEFINT を忘れずに実行することです。

・ＢＬＯＡＤを忘れる。
　一生懸命必死になってテストルーチンを作ってもＢＬＯＡＤを忘れては何にもなりません。でもよくあるんです、これが。特に新しいマシン語ファイルを追加したときなどは注意すべきです。




ｱ｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣ｵ
･　　　　　　　　　　　　　　　　　まとめ                                  ･
ｹ｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣｣ｽ

		synopsis		      address

	PAL.INIT				3
	PAL.SET( PAL.CODE, PAL.VALUE )		6
	PAL.SHOW( PAL.GRADE )			9
	PAL.FADE( PAL.RATE )			12
	PAL.STAT( RET.VALUE )			15
	PAL.DONE				18








       PAL.BIN : Palette control routines for BASIC. Copyright 1991 by Ana.
                            The end of 'PAL.DOC'


